{{> header}}
<div id="main-content">
    <div class="search-form">
        <p class="search-section-sentence">Search. Find. Contact. Rate.</p>
        <p class="search-section-sentence">Avoid bad landlord experiences.</p>
        <form>
            <input id="search-text" name="search-text" type="search"
                placeholder="Search for properties or landlords...">
            <input type="button" value="search" id="search-button" onclick="executeSearch()"/>
        </form>
    </div>
    <div class="home-reviews-section">
        <h1 class="search-section-sentence">Top 3 Landlords</h1>
        {{> cards}}
    </div>
</div>
{{>footer}}

<script>
    let searchButton = document.getElementById("search-button");

    function createCard(postData) {
        return `<div class="container">
    <di class="container-profile">
        <p class="landlord-name">Sarah Therrien</p>
        <p class="landlord-rating">9.9</p>
    </di>
    <img class="landlord-img"
        src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1050&q=80">
</div>`;
    }

    function executeSearch() {
        let searchTerm = document.getElementById("search-text").value;
        if (!searchTerm) {
            location.replace('/');
            return;
        }
        let mainContent = document.getElementById("main-content");
        let searchURL = `/posts/?search-text=${searchTerm}`;
        location.replace(`http://localhost:8080${searchURL}`);
        fetch(searchURL)
            .then((data) => {
                console.log(data);
                return data.json();
            })
            .then((data_json) => {
                let newMainContentHTML = '';
                data_json.results.forEach((row) => {
                    newMainContentHTML += createCard(row);
                });
                mainContent.innerHTML = newMainContentHTML;
            })
            .catch((err) => console.log(err));
    }
</script>